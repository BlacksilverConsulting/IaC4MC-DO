---
# This is the CALLABLE server restart role.
# Use this freely instead of repeating these tasks everywhere!

- name: "Stop minecraft service"
  ansible.builtin.service:
    name: minecraft
    state: stopped

- name: "Restart minecraft service"
  ansible.builtin.service:
    name: minecraft
    state: restarted

- name: "Wait for server to come up after restart"
  ansible.builtin.wait_for:
    port: "{{ server_port }}"
    state: started
    timeout: "{{ startup_timeout }}"
  register: restart_server_wait

- name: "Check startup result after restart"
  ansible.builtin.fail:
    msg: "The Minecraft service did not start within {{ startup_timeout }} seconds"
  when: not restart_server_wait.elapsed
